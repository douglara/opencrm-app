<section class="px-8 bg-brand-palette-08 ">
  <div class="mb-4 mt-4 p-4 bg-light-palette-p5 border-2 border-light-palette-p3 rounded"> 
    <nav aria-label="breadcrumb" >
      <ol class="flex space-x-2 items-center text-center" >
        <% @deal.stage.pipeline.stages.each_with_index do | stage, index | %>
          <% if stage == @deal.stage and @deal.status == 'open' or @deal.stage.order > stage.order %>
            <li class="<%= stage == @deal.stage ? 'pointer-events-none' : '' %> first:rounded-l-lg last:rounded-r-lg flex-1 bg-auxiliary-palette-green relative hover:bg-auxiliary-palette-green-down " style="z-index: <%= 30 - index  %> " aria-current="page">
              <%= link_to stage.name, account_deal_path(current_user.account, @deal, deal: { status: 'open', stage_id: stage.id } ), method: :patch, data: { confirm: 'Are you sure?' }, class: " font-bold text-light-palette-p5 py-1.5 w-full px-7 hover:text-auxiliary-palette-green before:absolute inline-block #{ index == @deal.stage.pipeline.stages.length - 1 ? '' : "before:top-0 before:z-10 before:right-[-20px] before:border-solid before:border-l-auxiliary-palette-green before:hover:border-l-auxiliary-palette-green-down before:border-l-[20px] before:border-y-transparent before:border-y-[20px] after:absolute after:top-0  after:border-solid after:border-l-[20px] after:border-y-transparent after:border-y-[20px]  inline-block  after:absolute after:top-0  after:border-solid after:border-l-light-palette-p5 after:border-l-[20px] after:border-y-transparent after:right-[-28px] after:border-y-[20px]" } " %>  
            </li>
          <% else %>
            <li class="flex-1 bg-gray-100 relative hover:bg-gray-200 <%= stage == @deal.stage ? 'pointer-events-none' : '' %> first:rounded-l-lg last:rounded-r-lg",  style="z-index: <%= 30 - index  %> ">
              <%= link_to stage.name, account_deal_path(current_user.account, @deal, deal: { status: 'open', stage_id: stage.id } ), method: :patch, data: { confirm: 'Are you sure?' }, class: "font-semibold inline-block text-gray-500 py-1.5 w-full px-7 #{ index == @deal.stage.pipeline.stages.length - 1 ? '' : "before:absolute before:top-0 before:z-10 before:right-[-20px] before:border-solid before:border-l-gray-100 before:hover:border-l-gray-200 before:border-l-[20px] before:border-y-transparent before:border-y-[20px] after:absolute after:top-0  after:border-solid after:border-l-[20px] after:border-y-transparent after:border-y-[20px]    after:absolute after:top-0  after:border-solid after:border-l-light-palette-p5 after:border-l-[20px] after:border-y-transparent after:right-[-28px] after:border-y-[20px]" } " %>            
            </li>
          <% end %>
        <% end %>
      </ol>
    </nav>

  </div>
  <div class="grid grid-cols-1 min-[1400px]:grid-cols-[minmax(500px,_1fr)_3fr] gap-8 w-full ">
    <div class="hidden min-[1400px]:block">
      <%= render "/accounts/deals/details" %>
    </div>
    <div class="relative min-[1400px]:hidden flex items-center h-10 pr-3 border-2 rounded-lg bg-light-palette-p5 border-light-palette-p3">
      <div class="p-2  border-r-2 border-r-light-palette-p3 rounded-l-md">
        <i data-lucide="chevron-right" ></i>
      </div>
      <p class="m-0 font-semibold mx-2 text-center">Informações</p>
      <p class=" m-0 items-center text-center whitespace-nowrap truncate pl-2 font-medium before:bg-light-palette-p3 before:absolute before:rounded-full before:left-[135px] before:h-7 before:w-0.5 before:bg-indigo-500">Resumo, Pessoa, Organização</p>
    </div>
    
    <div class="">
      <div class="gap-8">
        <%= turbo_frame_tag "new-event-form", src: new_account_contact_event_path(account_id: current_user.account, contact_id: @deal.contact.id, deal_id: @deal.id) %>
      </div>
      <div class="mt-8">
        <%= render "/accounts/contacts/events/events", deal: @deal, events: @events %>
      </div>
    </div>
  </div>
</section>