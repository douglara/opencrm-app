<% deal.stage.pipeline.stages.each_with_index do | stage, index | %>
    <% if stage == deal.stage and deal.status == 'open' or deal.stage.order > stage.order %>
    <li class="<%= stage == deal.stage ? 'pointer-events-none' : '' %> first:rounded-l-lg last:rounded-r-lg flex-1 bg-auxiliary-palette-green relative hover:bg-auxiliary-palette-green-down whitespace-nowrap" style="z-index: <%= 30 - index  %> " aria-current="page">
        <%= link_to stage.name, account_deal_path(current_user.account, deal, deal: { status: 'open', stage_id: stage.id } ), method: :patch, data: { confirm: 'Are you sure?' }, class: " font-bold text-light-palette-p5 py-1.5 w-full px-7 hover:text-auxiliary-palette-green before:absolute inline-block #{ index == deal.stage.pipeline.stages.length - 1 ? '' : "before:top-0 before:z-10 before:right-[-20px] before:border-solid before:border-l-auxiliary-palette-green before:hover:border-l-auxiliary-palette-green-down before:border-l-[20px] before:border-y-transparent before:border-y-[20px] after:absolute after:top-0  after:border-solid after:border-l-[20px] after:border-y-transparent after:border-y-[20px]  inline-block  after:absolute after:top-0  after:border-solid after:border-l-light-palette-p5 after:border-l-[20px] after:border-y-transparent after:right-[-28px] after:border-y-[20px]" }" %>  
    </li>
    <% else %>
    <li class="flex-1 bg-gray-100 relative hover:bg-gray-200 <%= stage == deal.stage ? 'pointer-events-none' : '' %> first:rounded-l-lg last:rounded-r-lg",  style="z-index: <%= 30 - index  %> ">
        <%= link_to stage.name, account_deal_path(current_user.account, deal, deal: { status: 'open', stage_id: stage.id } ), method: :patch, data: { confirm: 'Are you sure?' }, class: "font-semibold inline-block text-gray-500 py-1.5 w-full px-7 #{ index == deal.stage.pipeline.stages.length - 1 ? '' : "before:absolute before:top-0 before:z-10 before:right-[-20px] before:border-solid before:border-l-gray-100 before:hover:border-l-gray-200 before:border-l-[20px] before:border-y-transparent before:border-y-[20px] after:absolute after:top-0  after:border-solid after:border-l-[20px] after:border-y-transparent after:border-y-[20px]    after:absolute after:top-0  after:border-solid after:border-l-light-palette-p5 after:border-l-[20px] after:border-y-transparent after:right-[-28px] after:border-y-[20px]" }" %>            
    </li>
    <% end %>
<% end %>